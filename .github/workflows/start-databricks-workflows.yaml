name: Run Unit Tests in Databricks Workflows

on:
  workflow_dispatch:
  push:
    branches-ignore:
      - "main"
      - "release/*"
    paths-ignore:
      - "terraform/**"
      - ".github/**"
      - "README.md"

jobs:
  development_branch_info:
    runs-on: ubuntu-latest
    steps:
      - name: Check out code
        uses: actions/checkout@v3

      - name: install-databricks-cli
        uses: databricks/setup-cli@main

      - name: update Databricks Job
        env:
          DATABRICKS_HOST: ${{ secrets.DATABRICKS_HOST }}
          DATABRICKS_TOKEN: ${{ secrets.DATABRICKS_PAT }}
        run: |
          branch_name=${{ github.head_ref }}
          repo_url=${{ github.repository }}
          job_id=${{vars.JOB_ID}}
          # Replace 'JOB_ID' with the actual Job ID and ensure the JSON is correctly formatted for your job
          job_update_json="{\"job_id\": $job_id, \"new_settings\": {\"git_source\": {\"git_url\": \"$repo_url\", \"branch\": \"$branch_name\"}}}"
          databricks jobs update --json "$job_update_json"

      - name: Echo Development Branch Name
        run: |
          echo "Development Branch Pushed: ${{ github.head_ref }}
